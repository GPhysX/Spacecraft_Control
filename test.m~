s = spacecraft;
thetas = zeros(15000,3);
time = zeros(15000,1);
c = pd;
i = 0;
commands = {[0 0 0]'; [70 70 70]'; [-70 -70 -70]';[0 0 0]'};
times = [9.99, 50, 90, 150];

for j = 1:length(times)
    c = c.setref_d(commands{j});
    while s.t < times(j)
        i = i+1;
        c = c.control(s.x);
        if mod(i,10) == 0
            
        s.Tc = s.J*c.v + cross(s.rot,s.J*s.rot) - s.Td;
        s = s.sim;
        thetas(i,:) = s.theta';
        time(i) = s.t;
    end
end
    
figure
plot(time(1:i), thetas(1:i,:))
c.er